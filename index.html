<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-2HYGF91GN7"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		const measureId = 'G-2HYGF91GN7';
		function gtag() { dataLayer.push(arguments); }
		function initUserId(value) {
			gtag('config', measureId, {
				debug_mode: true,
				user_code: 'user' + value,
				user_properties: {
					user_code: 'userA' + value,
				}
			});
			let sign = prompt("Enter your user_id for GA from init:");
			if (sign) {
				gtag("set", { 'user_id': sign + 'aa' });
				gtag("set", { 'test_user_id': sign + 'bb' });
				gtag("config", measureId, { 'test_user_id': sign + 'bb' });
				//gtag("set", { 'user_code': sign + 'cc' });
				console.log("from init");
			}
			console.log(value);
		}
		gtag('js', new Date());
		gtag('get', measureId, 'client_id', function(value) {
			initUserId(value);
		})
	</script> -->
	<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-44QBL78MEQ"></script> -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://webtracking-v01.creatio.com/JS/create-object.js"></script>
	<!-- <script>
		const TAG_ID = 'G-44QBL78MEQ';
		window.dataLayer = window.dataLayer || [];
		window.creatioData = {
			time: new Date().getTime()
		};
		setInterval(() => {
			window.creatioData.time = new Date().getTime();
		}, 100);

		function gtag() {
			dataLayer.push(arguments);
		}

		gtag('js', new Date());

		const getSessionId = new Promise(resolve => {
			// gtag('event', 'page_view', {
			// 	sa_time: new Date().getTime()
			// });
			gtag('get', TAG_ID, 'session_id', resolve);
		});

		const getClientId = new Promise(resolve => {
			gtag('get', TAG_ID, 'client_id', resolve);
		});

		getClientId.then((clientId) => {
			getSessionId.then((sessionId) => {
				gtag('config', TAG_ID, {
					'debug_mode': true,
					'custom_session_id': `g${sessionId}`,
					'custom_user_id': `g${clientId}`,
					'sa_time': window.creatioData.time,
					// 'user_properties': {
					// 	'custom_session_id': `g${sessionId}`,
					// 	'custom_user_id': `g${clientId}`,
					// }
				});
				console.log("client id is " + clientId);
			});
		});
	</script> -->
	<script>
		window.TAG_ID = 'G-VCF8X5W0DC';
	</script>
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VCF8X5W0DC"></script>
	<script src="https://webtracking-v01.creatio.com/JS/create-object.js"></script>
	<!-- <script src="https://webtracking-v01.creatio.com/JS/crt-gtag.js"></script> -->


	<script>
function createOrReplaceInput(inputName, inputValue, formSelector, currentForm) {
	var existingInput = jQuery(formSelector + " input[name='" + inputName + "']")[0];
	if (existingInput) {
		existingInput.value = inputValue;
	} else {
		var newInput = document.createElement('input');
		newInput.setAttribute('type', 'hidden');
		newInput.setAttribute('name', inputName);
		newInput.setAttribute('value', inputValue);

		currentForm.appendChild(newInput);
	}
}
/* The function below pass TrackingUserId from GoogleAnalytics to data for sending to Creatio. */
function extendTrackingData(googleClientId) {
	googleClientId = googleClientId || "";
	const googleTrackingSystemId = '310174AE-1DF5-4BB1-8955-474548D52666';
	console.log("defineVisitor:Started", googleClientId);
	var currentUrl = window.location.href;
	//foreach form add hidden fields with names: TrackingUserId , PageUrl, TrackingId
	var formsCollection = document.getElementsByTagName('form');
	for (var i = 0; i < formsCollection.length; i++) {
		var formSelector = "";
		if (formsCollection[i].id) {
			formSelector = "#" + formsCollection[i].id;
		} else if (formsCollection[i].name) {
			formSelector = "form[name='" + formsCollection[i].name + "']";
		}
		createOrReplaceInput("TrackingUserId", googleClientId, formSelector, formsCollection[i]);
		createOrReplaceInput("PageUrl", currentUrl, formSelector, formsCollection[i]);
		createOrReplaceInput("TrackingId", googleTrackingSystemId, formSelector, formsCollection[i]);
	}
}

(async () => {
	window.dataLayer = window.dataLayer || [];

	const defaultGtag = function () {
		dataLayer.push(arguments);
	};

	window.gtag = window.gtag || defaultGtag;

	gtag('js', new Date());

	const tagId = `${window.TAG_ID}`;
	if (!tagId) {
		console.warn('TAG_ID is not set.\nPlease specify the tag using the script below:\n\n<script>\n\twindow.TAG_ID = "G-.........."\n<\/script>');
		return;
	}

	const getSessionId = new Promise(resolve => {
		gtag('get', tagId, 'session_id', resolve);
	});

	const getClientId = new Promise(resolve => {
		gtag('get', tagId, 'client_id', resolve);
	});

	const clientId = await getClientId;
	const sessionId = await getSessionId;
	jQuery(document).ready(extendTrackingData.bind(this, clientId));
	const contactId = landing && landing.contactId && landing.contactId.value;

	const customConfig = {
		'crt_session_id': `${clientId}::${sessionId}`,
		'crt_user_id': contactId || ''
	};
	gtag('config', tagId, customConfig);
})();
	</script>

</head>

<body>
	<script>
		function createObject() {
			console.log("form submitterd");
			gtag("event", "sa_time", {
				"sa_time": new Date().getTime()
			});
			// let sign = prompt("Enter your user_id for GA:");
			// if (sign) {
			// 	gtag("set", { 'user_id': sign + 'aa' });
			// 	gtag("set", { 'test_user_id': sign + 'bb' });
			// 	gtag("set", { 'user_code': sign + 'cc' });
			// 	console.log("tag is added (" + sign + ")");
			// }
		}
	</script>
	<!-- <script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('get', 'G-2HYGF91GN7', 'session_id', (id) => {
	  gtag('config', 'G-2HYGF91GN7', {
		  'custom_session_id': id,
		  'user_code': 'testUser'
	  });
	});
  </script> -->
	<h1>Index</h1>
	<h2>
		Test tags
	</h2>
	<p>Lorem ipsum dolor ...</p>
	<p>Lorem ipsum dolor ...</p>
	<h3>Some text</h3>
	<div>
		<h2>Contact form</h2>
		<form method="POST" class="mainForm" name="landingForm" onSubmit="createObject(); return false">
			Name:<br>
			<input type="text" name="Name" id="name-field"><br>
			Email:<br>
			<input type="text" name="Email" id="email-field"><br><br><br>
			Phone:<br>
			<input type="text" name="Phone" id="phone-field"><br>
			Account:<br>
			<input type="text" name="Account" id="account-field"><br><br><br>
			TestParam:<br>
			<input type="text" name="TestParam" id="testparam-field"><br>
			Subject:<br>
			<input type="text" name="Subject" id="subject-field"><br>
			Symptoms:<br>
			<input type="text" name="Symptoms" id="symptoms-field">
			<br><br><br>
			<input type="submit" value="Submit">
		</form>
	</div>
</body>

</html>
