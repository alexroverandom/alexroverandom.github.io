<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-2HYGF91GN7"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		const measureId = 'G-2HYGF91GN7';
		function gtag() { dataLayer.push(arguments); }
		function initUserId(value) {
			gtag('config', measureId, {
				debug_mode: true,
				user_code: 'user' + value,
				user_properties: {
					user_code: 'userA' + value,
				}
			});
			let sign = prompt("Enter your user_id for GA from init:");
			if (sign) {
				gtag("set", { 'user_id': sign + 'aa' });
				gtag("set", { 'test_user_id': sign + 'bb' });
				gtag("config", measureId, { 'test_user_id': sign + 'bb' });
				//gtag("set", { 'user_code': sign + 'cc' });
				console.log("from init");
			}
			console.log(value);
		}
		gtag('js', new Date());
		gtag('get', measureId, 'client_id', function(value) {
			initUserId(value);
		})
	</script> -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-44QBL78MEQ"></script>
	<script>
		const TAG_ID = 'G-44QBL78MEQ';
		window.dataLayer = window.dataLayer || [];
		window.creatioData = {
			time: new Date().getTime()
		};
		setInterval(() => {
			window.creatioData.time = new Date().getTime();
		}, 100);

		function gtag() {
			dataLayer.push(arguments);
		}

		gtag('js', new Date());

		const getSessionId = new Promise(resolve => {
			// gtag('event', 'page_view', {
			// 	sa_time: new Date().getTime()
			// });
			gtag('get', TAG_ID, 'session_id', resolve);
		});

		const getClientId = new Promise(resolve => {
			gtag('get', TAG_ID, 'client_id', resolve);
		});

		getClientId.then((clientId) => {
			getSessionId.then((sessionId) => {
				gtag('config', TAG_ID, {
					'debug_mode': true,
					'custom_session_id': `g${sessionId}`,
					'custom_user_id': `g${clientId}`,
					'sa_time': window.creatioData.time,
					// 'user_properties': {
					// 	'custom_session_id': `g${sessionId}`,
					// 	'custom_user_id': `g${clientId}`,
					// }
				});
				console.log("client id is " + clientId);
			});
		});
	</script>
	<script>
		window.TAG_ID = 'G-VCF8X5W0DC';
	</script>
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VCF8X5W0DC"></script>
	<script src="https://webtracking-v01.creatio.com/JS/create-object.js"></script>
	<script src="https://webtracking-v01.creatio.com/JS/crt-gtag.js"></script>
</head>

<body>
	<script>
		function createObject() {
			console.log("form submitterd");
			gtag("event", "sa_time", {
				"sa_time": new Date().getTime()
			});
			// let sign = prompt("Enter your user_id for GA:");
			// if (sign) {
			// 	gtag("set", { 'user_id': sign + 'aa' });
			// 	gtag("set", { 'test_user_id': sign + 'bb' });
			// 	gtag("set", { 'user_code': sign + 'cc' });
			// 	console.log("tag is added (" + sign + ")");
			// }
		}
	</script>
	<!-- <script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('get', 'G-2HYGF91GN7', 'session_id', (id) => {
	  gtag('config', 'G-2HYGF91GN7', {
		  'custom_session_id': id,
		  'user_code': 'testUser'
	  });
	});
  </script> -->
	<h1>Index</h1>
	<h2>
		Test tags
	</h2>
	<p>Lorem ipsum dolor ...</p>
	<p>Lorem ipsum dolor ...</p>
	<h3>Some text</h3>
	<div>
		<h2>Contact form</h2>
		<form method="POST" class="mainForm" name="landingForm" onSubmit="createObject(); return false">
			Name:<br>
			<input type="text" name="Name" id="name-field"><br>
			Email:<br>
			<input type="text" name="Email" id="email-field"><br><br><br>
			Phone:<br>
			<input type="text" name="Phone" id="phone-field"><br>
			Account:<br>
			<input type="text" name="Account" id="account-field"><br><br><br>
			TestParam:<br>
			<input type="text" name="TestParam" id="testparam-field"><br>
			Subject:<br>
			<input type="text" name="Subject" id="subject-field"><br>
			Symptoms:<br>
			<input type="text" name="Symptoms" id="symptoms-field">
			<br><br><br>
			<input type="submit" value="Submit">
		</form>
	</div>
</body>

</html>
